<!DOCTYPE html>
<!--[if lt IE 7]>       <html class="no-js ie6 oldie" lang="en"> <![endif]-->
<!--[if IE 7]>          <html class="no-js ie7 oldie" lang="en"> <![endif]-->
<!--[if IE 8]>          <html class="no-js ie8 oldie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->  <html class="no-js" lang="en"> <!--<![endif]-->
<head>
    <title>First-Steps-DFU-Programming - MAV'RIC Library</title>
    <meta name="description" content="Highway to the Danger Zone" />
    <meta name="author" content="MAV'RIC Team">
    <meta charset="UTF-8">
    <link rel="icon" href="../themes/daux/img/favicon-navy.png" type="image/x-icon">
    <!-- Mobile -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Font -->
    <link href='//fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700&subset=latin,cyrillic-ext,cyrillic' rel='stylesheet' type='text/css'>
    <!-- CSS -->
    <link href='../themes/daux/css/theme.min.css' rel='stylesheet' type='text/css'><link href='../themes/daux/css/theme-navy.min.css' rel='stylesheet' type='text/css'>
    <!--[if lt IE 9]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>
<body class="">
    
    <a href="https://github.com/lis-epfl/MAVRIC_Library" target="_blank" id="github-ribbon" class="hidden-print"><img src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"></a>
<div class="container-fluid fluid-height wrapper">
    <div class="navbar navbar-static-top hidden-print">
        <div class="container-fluid">
            <a class="brand navbar-brand pull-left" href="../index.html">MAV'RIC Library</a>
        </div>
    </div>
    <div class="row columns content">
        <div class="left-column article-tree col-sm-3 hidden-print">
            <!-- For Mobile -->
            <div class="responsive-collapse">
                <button type="button" class="btn btn-sidebar" id="menu-spinner-button">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
            </div>
            <div id="sub-nav-collapse" class="sub-nav-collapse">
                <!-- Navigation -->
                <ul class='nav nav-list'><li class=''><a href="../Getting_Started.html">Getting Started</a></li><li class=''><a href="../Features/index.html" class="folder">Features</a><ul class='nav nav-list'></ul></li><li class=''><a href="../User_Guide/index.html" class="folder">User Guide</a><ul class='nav nav-list'></ul></li><li class=''><a href="../Developper_Guide/index.html" class="folder">Developper Guide</a><ul class='nav nav-list'></ul></li><li class='open'><a href="#" class="aj-nav folder">Pages From Wiki</a><ul class='nav nav-list'><li class=''><a href="../Pages_From_Wiki/Sidebar.html">Sidebar</a></li><li class=''><a href="../Pages_From_Wiki/Board-numbers.html">Board-numbers</a></li><li class=''><a href="../Pages_From_Wiki/Calibration-Bias-Factors.html">Calibration-Bias-Factors</a></li><li class=''><a href="../Pages_From_Wiki/Calibration-Scale-Factors.html">Calibration-Scale-Factors</a></li><li class=''><a href="../Pages_From_Wiki/Connect-a-Joystick-to-QGroundControl.html">Connect-a-Joystick-to-QGroundControl</a></li><li class=''><a href="../Pages_From_Wiki/Create-new-project-in-Codelite.html">Create-new-project-in-Codelite</a></li><li class=''><a href="../Pages_From_Wiki/Credits License.html">Credits License</a></li><li class=''><a href="../Pages_From_Wiki/Credits-Origin-of-the-Project.html">Credits-Origin-of-the-Project</a></li><li class=''><a href="../Pages_From_Wiki/DataLogging.html">DataLogging</a></li><li class=''><a href="../Pages_From_Wiki/Debug-via-minicom-software-on-Linux.html">Debug-via-minicom-software-on-Linux</a></li><li class=''><a href="../Pages_From_Wiki/Development-Code-style.html">Development-Code-style</a></li><li class=''><a href="../Pages_From_Wiki/Development-Create-new-messages.html">Development-Create-new-messages</a></li><li class=''><a href="../Pages_From_Wiki/Development-Doxygen-Documentation.html">Development-Doxygen-Documentation</a></li><li class=''><a href="../Pages_From_Wiki/Development-Doxygen-Tips.html">Development-Doxygen-Tips</a></li><li class=''><a href="../Pages_From_Wiki/Development-Wiki-How-to.html">Development-Wiki-How-to</a></li><li class=''><a href="../Pages_From_Wiki/Development-workflow.html">Development-workflow</a></li><li class=''><a href="../Pages_From_Wiki/Download-Firmware.html">Download-Firmware</a></li><li class=''><a href="../Pages_From_Wiki/Download-Git-Tools.html">Download-Git-Tools</a></li><li class=''><a href="../Pages_From_Wiki/Download-IDE.html">Download-IDE</a></li><li class=''><a href="../Pages_From_Wiki/Download-QGroundcontrol.html">Download-QGroundcontrol</a></li><li class=''><a href="../Pages_From_Wiki/Electronic-board.html">Electronic-board</a></li><li class=''><a href="../Pages_From_Wiki/FAQ.html">FAQ</a></li><li class=''><a href="../Pages_From_Wiki/First-Steps-Binding-your-Remote.html">First-Steps-Binding-your-Remote</a></li><li class=''><a href="../Pages_From_Wiki/First-steps-CDC-and-DFU-Drivers-issue-on-Windows.html">First-steps-CDC-and-DFU-Drivers-issue-on-Windows</a></li><li class=''><a href="../Pages_From_Wiki/First-steps-Connect-to-QGroundControl.html">First-steps-Connect-to-QGroundControl</a></li><li class='active'><a href="../Pages_From_Wiki/First-Steps-DFU-Programming.html">First-Steps-DFU-Programming</a></li><li class=''><a href="../Pages_From_Wiki/First-steps-Flashing-the-autopilot.html">First-steps-Flashing-the-autopilot</a></li><li class=''><a href="../Pages_From_Wiki/First-Steps-Installing-Bootloader.html">First-Steps-Installing-Bootloader</a></li><li class=''><a href="../Pages_From_Wiki/First-steps-pairing-XBee-modules.html">First-steps-pairing-XBee-modules</a></li><li class=''><a href="../Pages_From_Wiki/First-Steps-Setup-on-Linux.html">First-Steps-Setup-on-Linux</a></li><li class=''><a href="../Pages_From_Wiki/Flashing-a-microcontroller-for-the-first-time.html">Flashing-a-microcontroller-for-the-first-time</a></li><li class=''><a href="../Pages_From_Wiki/Home.html">Home</a></li><li class=''><a href="../Pages_From_Wiki/Quad-Assembly-Building-Steps.html">Quad-Assembly-Building-Steps</a></li><li class=''><a href="../Pages_From_Wiki/Quad-Assembly-Part-List.html">Quad-Assembly-Part-List</a></li><li class=''><a href="../Pages_From_Wiki/Quad-Assembly-Remote-Pairing.html">Quad-Assembly-Remote-Pairing</a></li><li class=''><a href="../Pages_From_Wiki/README.html">README</a></li><li class=''><a href="../Pages_From_Wiki/Remote-settings.html">Remote-settings</a></li><li class=''><a href="../Pages_From_Wiki/Setup-on-Windows.html">Setup-on-Windows</a></li></ul></li></ul>

                <div class="sidebar-links">
                    
                        <!-- Links -->
                        <a href="https://github.com/lis-epfl/MAVRIC_Library/archive/master.zip" target="_blank">Download</a><br><a href="https://github.com/lis-epfl/MAVRIC_Library" target="_blank">GitHub Repo</a><br><a href="https://github.com/lis-epfl/MAVRIC_Library/issues" target="_blank">Help/Support/Bugs</a><br>
                        <!-- Twitter -->
                        
                        <hr/>
                    
                    <p><small>Documentation generated by <a href="http://daux.io">Daux.io</a></small></p>
                </div>
            </div>
        </div>
        <div class="right-column  content-area col-sm-9">
            <div class="content-page">
                <article>
            <div class="page-header sub-header clearfix">
            <h1><a href="../Pages_From_Wiki/Sidebar.html">Pages From Wiki</a> <i class="glyphicon glyphicon-chevron-right"></i> <a href="../Pages_From_Wiki/First-Steps-DFU-Programming.html">First-Steps-DFU-Programming</a>            </h1>
                    <span style="float: left; font-size: 10px; color: gray;">
                        Tuesday, February 2, 2016                    </span>
                    <span style="float: right; font-size: 10px; color: gray;">
                        11:37 AM                    </span>
        </div>
    
    <p>Installing and using DFU-programmer with the MAV'RIC board</p>
<h1>1) Instructions for dfu-programmer</h1>
<h2>LINUX instructions</h2>
<h3>a) Install dfu-programmer</h3>
<ul>
<li>install libusb-1.0-0-dev as proposed in the README from dfu-programmer:<br />
<code>sudo apt-get install libusb-1.0-0-dev</code>
</li>
<li>download dfu-programmer (tar-ball file) from [[ Sourceforge | http://sourceforge.net/projects/dfu-programmer/?source=typ_redirect ]]</li>
<li>extract it somewhere:<br />
<code>unzip &lt;downloaded file&gt;.zip</code> or <code>tar xvfz &lt;downloaded file&gt;.tar.gz</code>
</li>
<li>enter directory and follow build instructions:</li>
</ul>
<pre><code>./configure
make
sudo cp src/dfu-programmer /usr/local/bin
</code></pre>
<h3>b) Allow standard users to access the board via usb:</h3>
<ul>
<li>Create the file <code>/etc/udev/rules.d/99-dfu_programmer.rules</code> with the following content:<br />
WARNING: GROUP=&quot;your user name or a group that you belong to&quot;<br />
<code>ATTR{idVendor}==&quot;03eb&quot;, ATTR{idProduct}==&quot;*&quot;, GROUP=&quot;users&quot;, MODE=&quot;0660&quot;</code>
</li>
<li>Reboot</li>
</ul>
<h3>c) A typical flashing sequence:</h3>
<pre><code>dfu-programmer at32uc3c1512 erase
dfu-programmer at32uc3c1512 get 
dfu-programmer at32uc3c1512 flash &lt;flash-image.hex&gt; --suppress-bootloader-mem 
dfu-programmer at32uc3c1512 reset 
</code></pre>
<p>The script <code>dfu_program.sh</code> with this command sequence is useful to add to an IDE &quot;Run&quot; command, so that flashing can be done by clicking a button or automatically after make.</p>
<h2>WINDOWS instructions</h2>
<h3>a) Install driver</h3>
<ul>
<li>connect a USB cable to a MAV'RIC board WITH the bootloader FLASHED (If it's not the case, read the documentation related to the bootloader)<br />
WARNING: Some cellphone cables are only for charging through USB, DO NOT use one of them</li>
<li>install the driver: (DO NOT let windows search for the driver), go to &quot;Control panel&quot;, &quot;Device manager&quot;, select the DFU programmer, Specify the path to the .inf file found in the folder <code>MAVRIC\Utilities\DFU-programmer\DFU\dfu-prog-usb-1.2.2</code>
</li>
</ul>
<h3>b) A typical flashing sequence:</h3>
<pre><code>dfu-programmer at32uc3c1512 erase
dfu-programmer at32uc3c1512 get 
dfu-programmer at32uc3c1512 flash &lt;flash-image.hex&gt; --suppress-bootloader-mem 
dfu-programmer at32uc3c1512 reset 
</code></pre>
<p>The script <code>dfu-programming.bat</code> with this command sequence has to be in your project folder. This script flashes your last compiled .hex to your MAV'RIC board (by default the file <code>&lt;YourProject&gt;/Release/megafly.hex</code>)</p>
<ul>
<li>copy <code>mklink_egDFU.bat</code> from <code>MAVRIC\Utilities\DFU-programmer\</code> in your project directory and rename it to mklink_DFU.bat</li>
<li>edit this file and replace <relative path to MAVRIC> by the relative path from project to MAVRIC (e.g: <code>../../MAVRIC</code>)</li>
<li>copy <code>dfu-programming.bat</code> from <code>MAVRIC\Utilities\DFU-programmer\</code> in your project directory</li>
<li>execute this script whenever you want to flash your code (the .hex file by default is <code>Release/megafly.hex</code>)</li>
</ul>
<h1>2) Instructions for flashing code in the MAV'RIC board</h1>
<p>In order to flash the code on the MAV'RIC board, a bootloader is running at startup. During the boot, the pin SDA1 (corresponding to PC04) is tested to determine wheter the DFU software or the application will start.
During a normal startup, the application will start as the pin SDA1 is pulled up by a resistor.
For launching the DFU software, the pin SDA1 must be set to 0, for example, by connecting the pin n°1 (SDA1) and n°5 (GND) of an I2C 1 connector. An extra push button might also be used if soldered between SDA1 and GND.
After a flash of the bootloader, the DFU software is forced to start allowing a first application flashing.</p>
<h3>a) Flashing code right after flashing the bootloader</h3>
<ul>
<li>connect the usb cable to a MAV'RIC board WITH the bootloader FLASHED (If it's not the case, read the documentation related to the bootloader)</li>
<li>run the script <code>dfu-programming.bat</code> in windows, <code>dfu_program.sh</code> in linux or execute manually a flashing sequence in a terminal</li>
</ul>
<h3>b) Flashing code with an existing application</h3>
<ul>
<li>connect the usb cable to a MAV'RIC board WITH the bootloader FLASHED (If it's not the case, read the documentation related to the bootloader)</li>
<li>Start in bootloader mode:</li>
<li>Board v4.1.1: Press the push-button on the corner of the board while pressing the microcontroller's reset push-button</li>
<li>Board v4.1: Ground SDA1 pin using a wire between pin 1 and 5 of an I2C connector and press the microcontroller's reset push-button</li>
<li>run the script <code>dfu-programming.bat</code>, <code>dfu_program.sh</code> in linux or execute manually a flashing sequence in a terminal</li>
<li>remove the grounding of SDA1 pin</li>
</ul>

        <nav>
        <ul class="pager">
            <li><a href="../Pages_From_Wiki/First-steps-Connect-to-QGroundControl.html">Previous</a></li>            <li><a href="../Pages_From_Wiki/First-steps-Flashing-the-autopilot.html">Next</a></li>        </ul>
    </nav>
    </article>

            </div>
        </div>
    </div>
</div>

    

    <!-- jQuery -->
    <script src="../themes/daux/js/jquery-1.11.3.min.js"></script>
    <!-- hightlight.js -->
    <script src="../themes/daux/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <!-- JS -->
    
    <script src="../themes/daux/js/daux.js"></script>
</body>
</html>
