<!DOCTYPE html>
<!--[if lt IE 7]>       <html class="no-js ie6 oldie" lang="en"> <![endif]-->
<!--[if IE 7]>          <html class="no-js ie7 oldie" lang="en"> <![endif]-->
<!--[if IE 8]>          <html class="no-js ie8 oldie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->  <html class="no-js" lang="en"> <!--<![endif]-->
<head>
    <title>Calibration-Scale-Factors - MAV'RIC Library</title>
    <meta name="description" content="Highway to the Danger Zone" />
    <meta name="author" content="MAV'RIC Team">
    <meta charset="UTF-8">
    <link rel="icon" href="../themes/daux/img/favicon-navy.png" type="image/x-icon">
    <!-- Mobile -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Font -->
    <link href='//fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700&subset=latin,cyrillic-ext,cyrillic' rel='stylesheet' type='text/css'>
    <!-- CSS -->
    <link href='../themes/daux/css/theme.min.css' rel='stylesheet' type='text/css'><link href='../themes/daux/css/theme-navy.min.css' rel='stylesheet' type='text/css'>
    <!--[if lt IE 9]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>
<body class="">
    
    <a href="https://github.com/lis-epfl/MAVRIC_Library" target="_blank" id="github-ribbon" class="hidden-print"><img src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"></a>
<div class="container-fluid fluid-height wrapper">
    <div class="navbar navbar-static-top hidden-print">
        <div class="container-fluid">
            <a class="brand navbar-brand pull-left" href="../index.html">MAV'RIC Library</a>
        </div>
    </div>
    <div class="row columns content">
        <div class="left-column article-tree col-sm-3 hidden-print">
            <!-- For Mobile -->
            <div class="responsive-collapse">
                <button type="button" class="btn btn-sidebar" id="menu-spinner-button">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
            </div>
            <div id="sub-nav-collapse" class="sub-nav-collapse">
                <!-- Navigation -->
                <ul class='nav nav-list'><li class=''><a href="../Getting_Started.html">Getting Started</a></li><li class=''><a href="../User_Guide/index.html" class="folder">User Guide</a><ul class='nav nav-list'></ul></li><li class=''><a href="../Toolchain/index.html" class="folder">Toolchain</a><ul class='nav nav-list'><li class=''><a href="../Toolchain/AVR32_compiler.html">AVR32 compiler</a></li><li class=''><a href="../Toolchain/AVR32_Bootloader.html">AVR32 Bootloader</a></li><li class=''><a href="../Toolchain/AVR32_DFU_Programming.html">AVR32 DFU Programming</a></li><li class=''><a href="../Toolchain/STM32.html">STM32</a></li><li class=''><a href="../Toolchain/Emulation.html">Emulation</a></li><li class=''><a href="../Toolchain/Test_Toolchains.html">Test Toolchains</a></li></ul></li><li class=''><a href="../Developper_Guide/index.html" class="folder">Developper Guide</a><ul class='nav nav-list'><li class=''><a href="../Developper_Guide/Create_New_Telemetry_Messages.html">Create New Telemetry Messages</a></li><li class=''><a href="../Developper_Guide/Data_Logging.html">Data Logging</a></li><li class=''><a href="../Developper_Guide/Code_style.html">Code style</a></li></ul></li><li class=''><a href="#" class="aj-nav folder">Contributing</a><ul class='nav nav-list'><li class=''><a href="../Contributing/Contribute_to_the_Documentation.html">Contribute to the Documentation</a></li><li class=''><a href="../Contributing/Development_Workflow.html">Development Workflow</a></li></ul></li><li class=''><a href="#" class="aj-nav folder">Module Description</a><ul class='nav nav-list'><li class=''><a href="../Module_Description/Ahrs_ekf.html">Ahrs ekf</a></li></ul></li><li class='open'><a href="#" class="aj-nav folder">Pages From Wiki</a><ul class='nav nav-list'><li class=''><a href="../Pages_From_Wiki/Calibration-Bias-Factors.html">Calibration-Bias-Factors</a></li><li class='active'><a href="../Pages_From_Wiki/Calibration-Scale-Factors.html">Calibration-Scale-Factors</a></li><li class=''><a href="../Pages_From_Wiki/Connect-a-Joystick-to-QGroundControl.html">Connect-a-Joystick-to-QGroundControl</a></li><li class=''><a href="../Pages_From_Wiki/Debug-via-minicom-software-on-Linux.html">Debug-via-minicom-software-on-Linux</a></li><li class=''><a href="../Pages_From_Wiki/Download-Firmware.html">Download-Firmware</a></li><li class=''><a href="../Pages_From_Wiki/Download-Git-Tools.html">Download-Git-Tools</a></li><li class=''><a href="../Pages_From_Wiki/Download-IDE.html">Download-IDE</a></li><li class=''><a href="../Pages_From_Wiki/Download-QGroundcontrol.html">Download-QGroundcontrol</a></li><li class=''><a href="../Pages_From_Wiki/Electronic-board.html">Electronic-board</a></li><li class=''><a href="../Pages_From_Wiki/FAQ.html">FAQ</a></li><li class=''><a href="../Pages_From_Wiki/First-Steps-Binding-your-Remote.html">First-Steps-Binding-your-Remote</a></li><li class=''><a href="../Pages_From_Wiki/First-steps-CDC-and-DFU-Drivers-issue-on-Windows.html">First-steps-CDC-and-DFU-Drivers-issue-on-Windows</a></li><li class=''><a href="../Pages_From_Wiki/First-steps-Connect-to-QGroundControl.html">First-steps-Connect-to-QGroundControl</a></li><li class=''><a href="../Pages_From_Wiki/First-steps-pairing-XBee-modules.html">First-steps-pairing-XBee-modules</a></li><li class=''><a href="../Pages_From_Wiki/Flashing-a-microcontroller-for-the-first-time.html">Flashing-a-microcontroller-for-the-first-time</a></li><li class=''><a href="../Pages_From_Wiki/Home.html">Home</a></li><li class=''><a href="../Pages_From_Wiki/Quad-Assembly-Building-Steps.html">Quad-Assembly-Building-Steps</a></li><li class=''><a href="../Pages_From_Wiki/Quad-Assembly-Part-List.html">Quad-Assembly-Part-List</a></li><li class=''><a href="../Pages_From_Wiki/Quad-Assembly-Remote-Pairing.html">Quad-Assembly-Remote-Pairing</a></li><li class=''><a href="../Pages_From_Wiki/Remote-settings.html">Remote-settings</a></li></ul></li></ul>

                <div class="sidebar-links">
                    
                        <!-- Links -->
                        <a href="https://github.com/lis-epfl/MAVRIC_Library/archive/master.zip" target="_blank">Download</a><br><a href="https://github.com/lis-epfl/MAVRIC_Library" target="_blank">GitHub Repo</a><br><a href="https://github.com/lis-epfl/MAVRIC_Library/issues" target="_blank">Help/Support/Bugs</a><br><a href="http://lis-epfl.github.io/MAVRIC_Library/doxygen/classes.html" target="_blank">Doxygen Documentation</a><br>
                        <!-- Twitter -->
                        
                        <hr/>
                    
                    <p><small>Documentation generated by <a href="http://daux.io">Daux.io</a></small></p>
                </div>
            </div>
        </div>
        <div class="right-column  content-area col-sm-9">
            <div class="content-page">
                <article>
            <div class="page-header sub-header clearfix">
            <h1><a href="../Pages_From_Wiki/Calibration-Bias-Factors.html">Pages From Wiki</a> <i class="glyphicon glyphicon-chevron-right"></i> <a href="../Pages_From_Wiki/Calibration-Scale-Factors.html">Calibration-Scale-Factors</a>            </h1>
                    <span style="float: left; font-size: 10px; color: gray;">
                        Tuesday, July 26, 2016                    </span>
                    <span style="float: right; font-size: 10px; color: gray;">
                        2:13 PM                    </span>
        </div>
    
    <p>This page will explain you how to calibrate the MAVRIC autopilot.
It is based on a paper by xxxx called : yyy</p>
<p>This page explains how to get the scale_factor of the IMU:
resume:
You will attach the board to the calibration setup (not the quad yet) and roll it smoothly, while logging the raw values of the accelerometer and magnetometer. It will give you points for all possible orientation of the MAV'RIC board. The crucial part, is not to add any external force while rolling the board, not to decrease the calibration performance.</p>
<h1>Steps:</h1>
<h2>Preliminar:</h2>
<ul>
<li>Open your project code and check that in src/mavlink_telemetry.c file, in <code>mavlink_telemetry_init(void)</code> function, RUN_REGULAR is set for imu_telemetry_send_raw, else set it.</li>
<li>Compile and flash the code (don't close Atmel as you will reuse it later on)</li>
<li>Attach the MAV'RIC board to the calibration setup</li>
<li>Plug a xbee module in the computer</li>
<li>Pair the xbee module with the one on the quad if not already done, see [[ Pairing XBee modules | First steps pairing XBee modules ]].</li>
<li>Power-up the MAV'RIC board with a 2s battery, that you can slice between the board and the calibration setup.</li>
<li>Open QGroundControl.</li>
<li>Connect through QGroundControl (top right of the window) and check that the connection succeed. (you should see the attitude moving for example)</li>
<li>Set the MAV'RIC board to a given orientation (e.g. parallel to the calibration setup with the graduation teeth in front)</li>
<li>Click Pro-&gt;plot in QGroundControl and select the six values RAW_IMU.xacc, .yacc, .zacc, .xmag, .ymag and .zmag .</li>
<li>Be ready to roll the setup smoothly, then you can press &quot;Start Logging&quot; (NOT &quot;LOG&quot;) at the bottom part of QGoundControl window.</li>
<li>Set the storage place of the log file to MAVRIC/Utilities/Calib_IMU, and call it day_month_year_MAVLINK_SYS_ID (e.g. 32_08_2014_MAV033 for a log made the 32nd of August 2014 with MAV'RIC board n°033). The ID is normally 201 by default, ask Grégoire Heitz for a new ID number.</li>
</ul>
<h2>Calibration:</h2>
<ul>
<li>Start rolling the board smoothly, 1 revolution/turn per graduation, then smoothly shift the MAV'RIC board orientation by one graduation, and follow until to reach the starting orientation graduation.</li>
<li>Press on &quot;Start logging&quot; again. It will end logging.</li>
</ul>
<h2>Get scale factors:</h2>
<ul>
<li>
<p>Make sure you are in your git branch</p>
</li>
<li>
<p>Go in MAVRIC/LEQuad/src/config/MAVcalib</p>
</li>
<li>
<p>Copy and paste MAV007_imu_config.h file,</p>
</li>
<li>
<p>rename the copy into MAVxxx_conf_imu_rev4.h, replacing xxx by your MAVLINK_SYS_ID.</p>
</li>
<li>
<p>Open Matlab and set the current folder to maveric/Utilities/Calib_IMU</p>
</li>
<li>
<p>open calibration_scripts.m</p>
</li>
<li>
<p>Change the file name to point to your logging file ending by _compressed.txt</p>
</li>
<li>
<p>Run the script.</p>
</li>
<li>
<p>Some figures will show up</p>
</li>
<li>
<p>Read in Matlab console the output scale factor for the accelerometer.</p>
</li>
<li>
<p>Paste them in MAVRIC/LEQuad/src/config/MAVcalib/MAVxxx_imu_config.h file (RAW_ACC_X_SCALE, RAW_ACC_Y_SCALE and RAW_ACC_Z_SCALE)</p>
</li>
<li>
<p>Then, repeat the same for the scale factor of the magnetometer.</p>
</li>
<li>
<p>Edit conf_platform.h file in MAVRIC/LEQuad/src/config, to change MAVLINK_SYS_ID with yours.</p>
</li>
<li>
<p>Drag and drop the file MAVRIC\LEQuad\src\config\MAVcalib\MAVxxx_imu_config.h in src/config/MAVcalib in Atmel Studio.</p>
</li>
<li>
<p>In conf_imu.h: before,</p>
</li>
</ul>
<pre><code>#else
#include &quot;conf_imu_rev4.h&quot;
#endif
</code></pre>
<p>add:</p>
<pre><code>#elif MAVLINK_SYS_ID == xxx
#include &quot;MAVcalib/MAVxxx_imu_config.h&quot;
</code></pre>
<p>changing xxx by your own MAVLINK_SYS_ID.</p>
<ul>
<li>Edit main.cpp file and add <code>onboard_parameters_write_parameters_to_flashc(&amp;central_data-&gt;mavlink_communication.onboard_parameters);</code> in the <code>initialization()</code> function. You can copy this just above <code>onboard_parameters_write_parameters_to_flashc(...)</code>.</li>
<li>Compile and flash the code</li>
<li>Edit main.cpp file to remove the <code>onboard_parameters_write_parameters_to_flashc(...)</code> line in the <code>initialization()</code> function.</li>
<li>You can now check if the scale factors have been correctly updated :</li>
<li>Start the autopilot and connect in QGroundControl</li>
<li>In QGroundControl, in the Analyse tab, press Refresh</li>
<li>Check the scale factor values (you should see 1/your_scale_factor)</li>
</ul>
<h3>You are DONE</h3>
<p>Now you can have a look on how to [[tune the bias for the accelerometer and magnetometer|Calibration Bias Factors]].</p>

        <nav>
        <ul class="pager">
            <li><a href="../Pages_From_Wiki/Calibration-Bias-Factors.html">Previous</a></li>            <li><a href="../Pages_From_Wiki/Connect-a-Joystick-to-QGroundControl.html">Next</a></li>        </ul>
    </nav>
    </article>

            </div>
        </div>
    </div>
</div>

    

    <!-- jQuery -->
    <script src="../themes/daux/js/jquery-1.11.3.min.js"></script>
    <!-- hightlight.js -->
    <script src="../themes/daux/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <!-- JS -->
    
    <script src="../themes/daux/js/daux.js"></script>
</body>
</html>
